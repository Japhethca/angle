# Frontend Feature-Based Structure Design

## Motivation

As the app scales with more features (seller dashboards, messaging, admin tools, etc.), the current flat `components/{concern}/` structure makes it harder to find related code. This design restructures the frontend into a hybrid feature-based architecture adapted for Phoenix/Inertia.js.

## Constraints

- **Inertia.js page resolution**: Pages must stay in `pages/` — controllers call `render_inertia("items/show")` which maps to `pages/items/show.tsx`
- **Auto-generated API layer**: `ash_rpc.ts` is generated by AshTypescript — no per-feature `api/` folders needed
- **Data loading**: Happens in Phoenix controllers via typed queries, not in React — no client-side routing or data fetching setup per feature
- **shadcn/ui**: Vendored component library stays in `components/ui/`

## Target Directory Structure

```
assets/js/
├── app.tsx                          # App entry point
├── ssr.tsx                          # SSR entry point
├── ash_rpc.ts                       # Auto-generated (do not touch)
│
├── features/                        # Domain-specific code
│   ├── auth/
│   │   ├── components/
│   │   │   ├── login-form.tsx
│   │   │   ├── register-form.tsx
│   │   │   ├── forgot-password-form.tsx
│   │   │   ├── reset-password-form.tsx
│   │   │   ├── guest-route.tsx
│   │   │   ├── protected-route.tsx
│   │   │   ├── permission-guard.tsx
│   │   │   ├── logout-button.tsx
│   │   │   └── auth-link.tsx
│   │   ├── hooks/
│   │   │   ├── use-auth-guard.ts
│   │   │   └── use-permissions.ts
│   │   ├── contexts/
│   │   │   └── auth-context.tsx
│   │   ├── types.ts
│   │   └── index.ts                 # Barrel export (public API)
│   │
│   ├── items/
│   │   ├── components/
│   │   │   ├── item-card.tsx
│   │   │   ├── item-form.tsx
│   │   │   ├── item-image-gallery.tsx
│   │   │   ├── item-detail-tabs.tsx
│   │   │   ├── condition-badge.tsx
│   │   │   ├── seller-card.tsx
│   │   │   └── similar-items.tsx
│   │   ├── types.ts
│   │   └── index.ts
│   │
│   ├── bidding/
│   │   ├── components/
│   │   │   ├── bid-form.tsx
│   │   │   ├── bid-section.tsx
│   │   │   └── confirm-bid-dialog.tsx
│   │   ├── hooks/
│   │   │   ├── use-bidding-channel.tsx
│   │   │   └── use-phoenix-channel.tsx
│   │   └── index.ts
│   │
│   └── home/
│       ├── components/
│       │   ├── featured-item-carousel.tsx
│       │   ├── ending-soon-section.tsx
│       │   ├── hot-now-section.tsx
│       │   ├── recommended-section.tsx
│       │   └── browse-categories-section.tsx
│       └── index.ts
│
├── components/
│   └── ui/                          # shadcn (unchanged)
│
├── layouts/
│   ├── layout.tsx
│   ├── auth-layout.tsx
│   └── footer.tsx
│
├── navigation/
│   ├── main-nav.tsx
│   └── bottom-nav.tsx
│
├── hooks/                           # Shared hooks
│   ├── use-ash-query.ts
│   └── use-mobile.ts
│
├── lib/                             # Shared utilities
│   ├── format.ts
│   └── utils.ts
│
├── types/                           # Global shared types
│   └── auth.ts
│
├── shared/                          # Shared components
│   └── components/
│       └── countdown-timer.tsx
│
└── pages/                           # Thin Inertia page wrappers
    ├── home.tsx
    ├── dashboard.tsx
    ├── bids.tsx
    ├── profile.tsx
    ├── settings.tsx
    ├── watchlist.tsx
    ├── auth/
    │   ├── login.tsx
    │   ├── register.tsx
    │   ├── forgot-password.tsx
    │   ├── reset-password.tsx
    │   ├── confirm-new-user.tsx
    │   └── verify-account.tsx
    ├── items/
    │   ├── show.tsx
    │   └── new.tsx
    └── admin/
        └── users.tsx
```

## Barrel Exports

Each feature has an `index.ts` that serves as its public API. Other features and pages import only from the barrel.

Example — `features/auth/index.ts`:

```ts
// Components
export { LoginForm } from "./components/login-form";
export { RegisterForm } from "./components/register-form";
export { ForgotPasswordForm } from "./components/forgot-password-form";
export { ResetPasswordForm } from "./components/reset-password-form";
export { ProtectedRoute } from "./components/protected-route";
export { GuestRoute } from "./components/guest-route";
export { PermissionGuard } from "./components/permission-guard";
export { LogoutButton } from "./components/logout-button";
export { AuthLink } from "./components/auth-link";

// Hooks
export { useAuthGuard } from "./hooks/use-auth-guard";
export { usePermissions } from "./hooks/use-permissions";

// Context
export { AuthProvider, useAuth } from "./contexts/auth-context";

// Types
export type { User, AuthState } from "./types";
```

## Import Rules

```ts
// Pages and other features import from barrel
import { LoginForm, useAuth } from "@/features/auth";
import { BidSection } from "@/features/bidding";
import { ItemCard } from "@/features/items";

// Shared hooks/utils use direct paths
import { useAshQuery } from "@/hooks/use-ash-query";
import { formatNaira } from "@/lib/format";

// Within a feature, use relative imports
import { LoginForm } from "./components/login-form";

// NEVER reach into another feature's internals
// import { LoginForm } from "@/features/auth/components/login-form"; // WRONG
```

## Path Aliases

Update `tsconfig.json`:

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./js/*"],
      "@/features/*": ["./js/features/*"],
      "@/ui/*": ["./js/components/ui/*"]
    }
  }
}
```

## Dependency Rules

### Allowed

```
pages/         -> features/*, layouts/, navigation/, hooks/, lib/, shared/, ui/
features/home/ -> features/items/ (home sections render item cards)
features/bidding/ -> features/auth/ (bid section checks auth state)
features/items/   -> (no feature dependencies — leaf feature)
features/auth/    -> (no feature dependencies — leaf feature)
layouts/       -> features/auth/ (layout renders auth link/logout)
navigation/    -> features/auth/ (nav renders auth state)
```

### Not Allowed

- `features/auth/` must NOT import from `features/items/` or `features/bidding/`
- `features/items/` must NOT import from `features/bidding/` — composition happens in the page
- No feature imports from `pages/`
- No feature imports from `layouts/` or `navigation/`

### Principle

If two features need to appear together on screen, the **page** composes them. Features don't reach into each other for UI composition. They only cross-import when there's a genuine runtime dependency (like bidding needing to check auth state).

When a dependency feels wrong:
1. Extract shared logic to `shared/` or `hooks/`
2. Move the composition up to the page level
3. Pass data via props rather than importing across features

## Page Conventions

Pages stay thin. They receive Inertia props, compose feature components, and nothing else. No business logic, no direct API calls, no local state beyond layout concerns.

```tsx
// pages/items/show.tsx
import type { ItemDetail, HomepageItemCard } from "@/ash_rpc";
import { BidSection } from "@/features/bidding";
import { ItemImageGallery, ItemDetailTabs, SellerCard, SimilarItems, ConditionBadge } from "@/features/items";
import { formatNaira } from "@/lib/format";
// ... compose and render, no business logic
```

If a page accumulates logic (computed state, multi-step flows), extract a hook or component into the relevant feature.

## File Naming

- All files use **kebab-case** (existing convention)
- Component exports use **PascalCase**
- Hook files prefixed with `use-`
- No `index.tsx` as component filenames — name files explicitly

## Migration Strategy

Migrate feature-by-feature. Each step is a standalone commit.

### Order

1. **Scaffold** — Create `features/` directory structure, barrel `index.ts` files, update `tsconfig.json` paths
2. **auth** — Move auth components, hooks, context, types. Update all imports. Most cross-cutting, so do first to flush out issues.
3. **items** — Move item components and types. Update pages and home components.
4. **bidding** — Move bidding components and hooks. Update item detail page.
5. **home** — Move home section components. Update home page.
6. **Shared + cleanup** — Move `countdown-timer` to `shared/`, flatten `navigation/` and `layouts/` to top level, remove empty `components/` directories (except `ui/`).

### Per-step checklist

- Move files to new locations
- Create/update barrel `index.ts`
- Update all imports (both `@/` and relative)
- Verify compilation: `npx tsc --noEmit`
- Commit

### What stays untouched

- `components/ui/` — shadcn vendored library
- `ash_rpc.ts` — auto-generated
- `pages/` locations — Inertia page resolver depends on these paths
- `app.tsx`, `ssr.tsx` — entry points
